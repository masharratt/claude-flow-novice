#!/bin/bash

# Benchmark Claude-Flow Conflicts - Safe Removal Script
# Generated by Claude Code Quality Analyzer
# Date: 2025-09-26

set -e  # Exit on any error

PROJECT_ROOT="/mnt/c/Users/masha/Documents/claude-flow-novice"
ARCHIVE_DIR="$PROJECT_ROOT/docs/archive/benchmark-conflicts"

echo "üîç Benchmark Claude-Flow Conflicts Removal"
echo "=========================================="
echo ""

# Verify we're in the right directory
if [ ! -d "$PROJECT_ROOT" ]; then
    echo "‚ùå Error: Project root not found at $PROJECT_ROOT"
    exit 1
fi

cd "$PROJECT_ROOT"

# Check if conflict directories exist
CONFLICTS_FOUND=0
if [ -d "benchmark/.claude" ]; then
    echo "‚úì Found: benchmark/.claude/ (976KB, 303 files)"
    CONFLICTS_FOUND=1
fi

if [ -d "benchmark/.claude-flow" ]; then
    echo "‚úì Found: benchmark/.claude-flow/ (4KB, 4 files)"
    CONFLICTS_FOUND=1
fi

if [ -d "benchmark/.github" ]; then
    echo "‚úì Found: benchmark/.github/ (12KB, 1 workflow)"
    CONFLICTS_FOUND=1
fi

if [ $CONFLICTS_FOUND -eq 0 ]; then
    echo "‚úÖ No conflicts found - cleanup already completed!"
    exit 0
fi

echo ""
echo "üì¶ Phase 1: Creating Backups"
echo "============================"

# Create archive directory
mkdir -p "$ARCHIVE_DIR/sessions"
echo "‚úì Created archive directory: $ARCHIVE_DIR"

# Backup valuable workflow if it exists
if [ -f "benchmark/.github/workflows/test-suite.yml" ]; then
    cp "benchmark/.github/workflows/test-suite.yml" "$ARCHIVE_DIR/"
    echo "‚úì Backed up: test-suite.yml (11KB)"
else
    echo "‚ö†Ô∏è  test-suite.yml not found - skipping backup"
fi

# Backup session summaries if they exist
SESSION_COUNT=0
if [ -d "benchmark/.claude/checkpoints" ]; then
    for file in benchmark/.claude/checkpoints/summary-session-*.md; do
        if [ -f "$file" ]; then
            cp "$file" "$ARCHIVE_DIR/sessions/"
            ((SESSION_COUNT++))
        fi
    done
    echo "‚úì Backed up: $SESSION_COUNT session summary files"
else
    echo "‚ö†Ô∏è  No session summaries found - skipping backup"
fi

echo ""
echo "üóëÔ∏è  Phase 2: Safe Removal"
echo "========================"

# Remove in order of dependency (least to most critical)
if [ -d "benchmark/.claude-flow" ]; then
    echo "üîÑ Removing benchmark/.claude-flow/..."
    rm -rf "benchmark/.claude-flow"
    echo "‚úÖ Removed: benchmark/.claude-flow/"
fi

if [ -d "benchmark/.github" ]; then
    echo "üîÑ Removing benchmark/.github/..."
    rm -rf "benchmark/.github"
    echo "‚úÖ Removed: benchmark/.github/"
fi

if [ -d "benchmark/.claude" ]; then
    echo "üîÑ Removing benchmark/.claude/..."
    rm -rf "benchmark/.claude"
    echo "‚úÖ Removed: benchmark/.claude/"
fi

echo ""
echo "‚úÖ Phase 3: Verification"
echo "======================="

# Verify removal
REMAINING_CONFLICTS=0
if [ -d "benchmark/.claude" ]; then
    echo "‚ùå Still exists: benchmark/.claude/"
    REMAINING_CONFLICTS=1
fi

if [ -d "benchmark/.claude-flow" ]; then
    echo "‚ùå Still exists: benchmark/.claude-flow/"
    REMAINING_CONFLICTS=1
fi

if [ -d "benchmark/.github" ]; then
    echo "‚ùå Still exists: benchmark/.github/"
    REMAINING_CONFLICTS=1
fi

if [ $REMAINING_CONFLICTS -eq 0 ]; then
    echo "‚úÖ All conflicts successfully removed!"
    echo ""
    echo "üìä Summary:"
    echo "  ‚Ä¢ Disk space recovered: ~992KB"
    echo "  ‚Ä¢ Files removed: ~308 files"
    echo "  ‚Ä¢ Backup location: $ARCHIVE_DIR"
    echo "  ‚Ä¢ Time taken: $(date)"
    echo ""
    echo "üéØ Next Steps:"
    echo "  1. Review backed up files in $ARCHIVE_DIR"
    echo "  2. Update any documentation references if needed"
    echo "  3. Proceed with claude-flow novice simplification"
else
    echo "‚ùå Some conflicts remain - manual intervention required"
    exit 1
fi

echo ""
echo "üéâ Benchmark conflict removal completed successfully!"
echo "====================================================="