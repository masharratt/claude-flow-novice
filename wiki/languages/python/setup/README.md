# Python Setup & Environment Management

Complete guide to setting up Python development environments with claude-flow orchestration for maximum productivity and consistency.

## üêç Python Version Management

### pyenv Installation and Setup

```bash
# Install pyenv (macOS/Linux)
curl https://pyenv.run | bash

# Add to shell profile
echo 'export PATH="$HOME/.pyenv/bin:$PATH"' >> ~/.bashrc
echo 'eval "$(pyenv init -)"' >> ~/.bashrc
echo 'eval "$(pyenv virtualenv-init -)"' >> ~/.bashrc

# Install Python versions
pyenv install 3.11.6
pyenv install 3.12.0
pyenv global 3.11.6

# Verify installation
python --version  # Should show Python 3.11.6
```

### Agent-Assisted Python Setup

```bash
# Use claude-flow to automate Python environment setup
Task("DevOps Engineer", "Setup Python development environment with pyenv and poetry", "cicd-engineer")

# Automated setup includes:
# - pyenv installation and configuration
# - Poetry dependency management
# - Virtual environment creation
# - IDE configuration (VS Code, PyCharm)
# - Git hooks for code quality
```

## üì¶ Virtual Environment Management

### Poetry (Recommended)

```bash
# Install Poetry
curl -sSL https://install.python-poetry.org | python3 -

# Initialize new project
poetry new my-python-project
cd my-python-project

# Add dependencies
poetry add fastapi uvicorn sqlalchemy
poetry add --group dev pytest black flake8 mypy

# Activate virtual environment
poetry shell

# Install dependencies
poetry install
```

### Poetry Configuration with Claude-Flow

```toml
# pyproject.toml generated by claude-flow agents
[tool.poetry]
name = "my-python-project"
version = "0.1.0"
description = "AI-generated Python application"
authors = ["Claude Flow Agent <agent@claude-flow.ai>"]
readme = "README.md"
packages = [{include = "app"}]

[tool.poetry.dependencies]
python = "^3.11"
fastapi = "^0.104.1"
uvicorn = {extras = ["standard"], version = "^0.24.0"}
sqlalchemy = "^2.0.23"
pydantic = "^2.5.0"
alembic = "^1.12.1"
python-jose = {extras = ["cryptography"], version = "^3.3.0"}
passlib = {extras = ["bcrypt"], version = "^1.7.4"}
python-multipart = "^0.0.6"

[tool.poetry.group.dev.dependencies]
pytest = "^7.4.3"
pytest-asyncio = "^0.21.1"
pytest-cov = "^4.1.0"
black = "^23.11.0"
isort = "^5.12.0"
flake8 = "^6.1.0"
mypy = "^1.7.1"
pre-commit = "^3.5.0"
httpx = "^0.25.2"

[tool.poetry.group.test.dependencies]
pytest-mock = "^3.12.0"
factory-boy = "^3.3.0"
freezegun = "^1.2.2"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

# Code quality configuration
[tool.black]
line-length = 88
target-version = ['py311']
include = '\.pyi?$'
extend-exclude = '''
/(
  migrations
  | venv
  | env
)/
'''

[tool.isort]
profile = "black"
multi_line_output = 3
line_length = 88
known_first_party = ["app"]

[tool.mypy]
python_version = "3.11"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
disallow_incomplete_defs = true
check_untyped_defs = true
no_implicit_optional = true
warn_redundant_casts = true
warn_unused_ignores = true

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py", "*_test.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
addopts = [
    "--strict-markers",
    "--strict-config",
    "--cov=app",
    "--cov-report=term-missing",
    "--cov-report=html",
    "--cov-fail-under=90"
]
asyncio_mode = "auto"
```

### Traditional venv (Alternative)

```bash
# Create virtual environment
python -m venv .venv

# Activate virtual environment
# macOS/Linux
source .venv/bin/activate
# Windows
.venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt

# Generate requirements
pip freeze > requirements.txt
```

## üõ†Ô∏è IDE Configuration

### VS Code Setup with Claude-Flow

```json
// .vscode/settings.json generated by agents
{
    "python.defaultInterpreterPath": "./.venv/bin/python",
    "python.terminal.activateEnvironment": true,
    "python.formatting.provider": "black",
    "python.linting.enabled": true,
    "python.linting.flake8Enabled": true,
    "python.linting.mypyEnabled": true,
    "python.linting.pylintEnabled": false,
    "python.testing.pytestEnabled": true,
    "python.testing.unittestEnabled": false,
    "python.testing.pytestArgs": [
        "tests"
    ],
    "editor.formatOnSave": true,
    "editor.codeActionsOnSave": {
        "source.organizeImports": true
    },
    "files.exclude": {
        "**/__pycache__": true,
        "**/*.pyc": true,
        ".pytest_cache": true,
        ".coverage": true,
        "htmlcov": true
    }
}
```

### VS Code Extensions

```json
// .vscode/extensions.json
{
    "recommendations": [
        "ms-python.python",
        "ms-python.flake8",
        "ms-python.black-formatter",
        "ms-python.isort",
        "ms-python.mypy-type-checker",
        "ms-toolsai.jupyter",
        "ms-toolsai.vscode-jupyter-slideshow",
        "charliermarsh.ruff",
        "ms-vscode.vscode-json"
    ]
}
```

### PyCharm Configuration

```bash
# Agent-assisted PyCharm setup
Task("IDE Configurator", "Configure PyCharm for Python development with code quality tools", "system-architect")

# Automated PyCharm configuration includes:
# - Interpreter setup
# - Code style configuration (Black, PEP 8)
# - Testing framework setup (pytest)
# - Debugging configuration
# - Git integration
```

## üîß Development Tools Setup

### Pre-commit Hooks

```yaml
# .pre-commit-config.yaml generated by claude-flow
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files

  - repo: https://github.com/psf/black
    rev: 23.11.0
    hooks:
      - id: black
        language_version: python3.11

  - repo: https://github.com/pycqa/isort
    rev: 5.12.0
    hooks:
      - id: isort
        args: ["--profile", "black"]

  - repo: https://github.com/pycqa/flake8
    rev: 6.1.0
    hooks:
      - id: flake8
        additional_dependencies: [flake8-docstrings]

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.7.1
    hooks:
      - id: mypy
        additional_dependencies: [types-requests]
```

### Makefile for Common Tasks

```makefile
# Makefile generated by claude-flow agents
.PHONY: install dev test lint format clean build deploy

# Installation
install:
	poetry install

dev:
	poetry install --with dev,test

# Code quality
format:
	poetry run black .
	poetry run isort .

lint:
	poetry run flake8 app tests
	poetry run mypy app
	poetry run black --check .
	poetry run isort --check-only .

# Testing
test:
	poetry run pytest

test-cov:
	poetry run pytest --cov=app --cov-report=html

test-watch:
	poetry run pytest-watch

# Development server
serve:
	poetry run uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# Database
db-upgrade:
	poetry run alembic upgrade head

db-migrate:
	poetry run alembic revision --autogenerate -m "$(message)"

# Docker
build:
	docker build -t my-python-app .

run:
	docker run -p 8000:8000 my-python-app

# Deployment
deploy-staging:
	poetry export -f requirements.txt --output requirements.txt
	docker build -t my-python-app:staging .
	docker push my-python-app:staging

deploy-prod:
	poetry export -f requirements.txt --without-hashes --output requirements.txt
	docker build -t my-python-app:latest .
	docker push my-python-app:latest

# Cleanup
clean:
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	rm -rf .pytest_cache
	rm -rf htmlcov
	rm -rf .coverage
```

## üê≥ Docker Setup

### Dockerfile for Python Applications

```dockerfile
# Multi-stage Dockerfile generated by claude-flow
FROM python:3.11-slim as builder

# Set environment variables
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PIP_NO_CACHE_DIR=1 \
    PIP_DISABLE_PIP_VERSION_CHECK=1

# Install system dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Install Poetry
RUN pip install poetry

# Copy dependency files
COPY pyproject.toml poetry.lock ./

# Configure Poetry and install dependencies
RUN poetry config virtualenvs.create false \
    && poetry install --only=main --no-interaction --no-ansi

# Production stage
FROM python:3.11-slim as production

# Set environment variables
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PATH="/app/.venv/bin:$PATH"

# Create non-root user
RUN groupadd -r appuser && useradd -r -g appuser appuser

# Install runtime dependencies
RUN apt-get update && apt-get install -y \
    && rm -rf /var/lib/apt/lists/*

# Copy installed packages from builder
COPY --from=builder /usr/local/lib/python3.11/site-packages /usr/local/lib/python3.11/site-packages
COPY --from=builder /usr/local/bin /usr/local/bin

# Set working directory
WORKDIR /app

# Copy application code
COPY --chown=appuser:appuser . .

# Switch to non-root user
USER appuser

# Expose port
EXPOSE 8000

# Health check
HEALTHCHECK --interval=30s --timeout=30s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:8000/health || exit 1

# Start application
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### Docker Compose for Development

```yaml
# docker-compose.yml for development environment
version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "8000:8000"
    volumes:
      - .:/app
      - ~/.cache/pypoetry:/root/.cache/pypoetry
    environment:
      - PYTHONPATH=/app
      - DATABASE_URL=postgresql://postgres:password@db:5432/myapp
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis
    command: uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

  db:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: myapp
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  test:
    build:
      context: .
      dockerfile: Dockerfile.dev
    volumes:
      - .:/app
    environment:
      - PYTHONPATH=/app
      - DATABASE_URL=postgresql://postgres:password@test_db:5432/test_myapp
    depends_on:
      - test_db
    command: pytest

  test_db:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: test_myapp
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    tmpfs:
      - /var/lib/postgresql/data

volumes:
  postgres_data:
```

## ü§ñ Agent-Assisted Environment Setup

### Automated Setup Workflow

```bash
# Complete environment setup with claude-flow
npx claude-flow@alpha sparc run architect "Python development environment with FastAPI"

# This spawns coordinated agents:
Task("Environment Engineer", "Setup Python, Poetry, and development tools", "cicd-engineer")
Task("IDE Configurator", "Configure VS Code with Python extensions", "system-architect")
Task("Docker Specialist", "Create Dockerfile and compose configuration", "backend-dev")
Task("Quality Engineer", "Setup pre-commit hooks and CI/CD", "tester")
```

### Memory-Assisted Configuration

```bash
# Store environment preferences
npx claude-flow@alpha mcp memory_usage --action store \
  --key "python/setup/preferences" \
  --value "poetry,black,pytest,fastapi,postgresql"

# Retrieve and apply preferences
npx claude-flow@alpha mcp memory_search --pattern "python/setup/*"
```

## üîç Environment Validation

### Health Check Script

```python
#!/usr/bin/env python3
"""Environment validation script generated by claude-flow agents."""

import subprocess
import sys
from pathlib import Path

def check_python_version():
    """Check Python version is 3.11+"""
    version = sys.version_info
    if version.major < 3 or (version.major == 3 and version.minor < 11):
        print("‚ùå Python 3.11+ required")
        return False
    print(f"‚úÖ Python {version.major}.{version.minor}.{version.micro}")
    return True

def check_poetry():
    """Check Poetry installation"""
    try:
        result = subprocess.run(["poetry", "--version"], capture_output=True, text=True)
        if result.returncode == 0:
            print(f"‚úÖ {result.stdout.strip()}")
            return True
    except FileNotFoundError:
        pass
    print("‚ùå Poetry not installed")
    return False

def check_virtual_env():
    """Check if virtual environment is active"""
    if hasattr(sys, 'real_prefix') or (hasattr(sys, 'base_prefix') and sys.base_prefix != sys.prefix):
        print("‚úÖ Virtual environment active")
        return True
    print("‚ö†Ô∏è  Virtual environment not active")
    return False

def check_project_structure():
    """Check project structure"""
    required_files = [
        "pyproject.toml",
        "app/__init__.py",
        "tests/__init__.py",
        ".gitignore"
    ]

    missing = []
    for file in required_files:
        if not Path(file).exists():
            missing.append(file)

    if missing:
        print(f"‚ùå Missing files: {', '.join(missing)}")
        return False
    print("‚úÖ Project structure complete")
    return True

def check_dependencies():
    """Check installed dependencies"""
    try:
        result = subprocess.run(["poetry", "check"], capture_output=True, text=True)
        if result.returncode == 0:
            print("‚úÖ Dependencies valid")
            return True
    except FileNotFoundError:
        pass
    print("‚ùå Dependencies invalid or Poetry not available")
    return False

def main():
    """Run all environment checks"""
    print("üêç Python Environment Validation")
    print("=" * 40)

    checks = [
        check_python_version,
        check_poetry,
        check_virtual_env,
        check_project_structure,
        check_dependencies
    ]

    results = [check() for check in checks]

    print("\n" + "=" * 40)
    if all(results):
        print("üéâ Environment setup complete!")
        return 0
    else:
        print("‚ùå Environment setup incomplete")
        return 1

if __name__ == "__main__":
    sys.exit(main())
```

## üìö Next Steps

1. **[Web Development Guide](../web-development/README.md)** - Django and Flask setup
2. **[Data Science Setup](../data-science/README.md)** - Jupyter and ML environments
3. **[Testing Configuration](../testing/README.md)** - Comprehensive testing setup
4. **[Deployment Guide](../examples/deployment.md)** - Production deployment strategies

---

**Environment ready?** Continue with [Web Development](../web-development/README.md) or explore [Data Science workflows](../data-science/README.md).